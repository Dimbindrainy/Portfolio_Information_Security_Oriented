<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Portfolio</title>

  <!-- Tailwind CSS CDN -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.3/dist/tailwind.min.css" rel="stylesheet">

  <!-- React CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

  <link rel="stylesheet" href="assets/styles.css">
</head>
<body class="bg-gray-100 font-sans">

<div id="root"></div>

<script type="text/babel">
const { useState, useEffect } = React;

// API helper functions
const fetchProjects = async (token=null) => {
  try {
    const res = await fetch("http://127.0.0.1:5000/projects/", {
      headers: token ? { "Authorization": `Bearer ${token}` } : {}
    });
    return await res.json();
  } catch {
    return [];
  }
};

const loginAdmin = async (username, password) => {
  try {
    const res = await fetch("http://127.0.0.1:5000/auth/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, password })
    });
    const data = await res.json();
    if (res.status === 200 && data.token) return data.token;
    return null;
  } catch {
    return null;
  }
};

// Project card component
const ProjectCard = ({ name, description }) => (
  <div className="bg-white p-6 rounded-lg shadow-md hover:shadow-xl transition">
    <h2 className="text-xl font-bold">{name}</h2>
    <p className="mt-2 text-gray-700">{description}</p>
  </div>
);

// Main App component
const App = () => {
  const [projects, setProjects] = useState([]);
  const [isAdmin, setIsAdmin] = useState(false);
  const [token, setToken] = useState(null);
  const [loginForm, setLoginForm] = useState({username:"", password:""});
  const [loginError, setLoginError] = useState("");

  useEffect(() => {
    fetchProjects(token).then(data => setProjects(data));
  }, [token]);

  const handleLogin = async (e) => {
    e.preventDefault();
    const t = await loginAdmin(loginForm.username, loginForm.password);
    if (t) {
      setToken(t);
      setIsAdmin(true);
      setLoginError("");
    } else {
      setLoginError("Invalid credentials");
    }
  };

  if (!isAdmin) {
    return (
      <div className="flex items-center justify-center h-screen">
        <form className="bg-white p-8 rounded-lg shadow-lg w-96" onSubmit={handleLogin}>
          <h1 className="text-2xl font-bold mb-6 text-center">Admin Login</h1>
          {loginError && <p className="text-red-500 mb-4">{loginError}</p>}
          <input
            type="text"
            placeholder="Username"
            className="w-full p-2 mb-4 border rounded"
            value={loginForm.username}
            onChange={e => setLoginForm({...loginForm, username: e.target.value})}
            required
          />
          <input
            type="password"
            placeholder="Password"
            className="w-full p-2 mb-4 border rounded"
            value={loginForm.password}
            onChange={e => setLoginForm({...loginForm, password: e.target.value})}
            required
          />
          <button type="submit" className="w-full bg-blue-600 text-white p-2 rounded hover:bg-blue-700 transition">Login</button>
          <p className="mt-4 text-gray-600 text-center">Or continue as guest</p>
          <button onClick={() => setIsAdmin(false)} className="w-full mt-2 border p-2 rounded hover:bg-gray-100 transition">Guest</button>
        </form>
      </div>
    );
  }

  return (
    <div className="max-w-6xl mx-auto p-8">
      <h1 className="text-4xl font-extrabold mb-8 text-center text-gray-900">My Portfolio Projects</h1>

      {projects.length === 0 ? (
        <p className="text-center text-gray-600">No projects loaded</p>
      ) : (
        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
          {projects.map((p, idx) => <ProjectCard key={idx} {...p} />)}
        </div>
      )}
    </div>
  );
};

// Render App
const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);
</script>
</body>
</html>
